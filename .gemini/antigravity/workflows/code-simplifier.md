---
description: 実装後のコード簡素化。最近の変更をレビューし、動作を保持しながら簡素化を提案・適用する
---

# 🧹 Code Simplifier

実装後のコードを簡素化します。動作を変えずに、よりクリーンでシンプルなコードに改善します。

## 哲学

- **シンプルが最善** - Less code = fewer bugs
- **明確さ > 賢さ** - 巧妙なコードより読みやすいコードを
- **動作は変えない** - 構造のみを変更
- **削除できるなら削除** - 不要なコードは負債

---

## Phase 1: 最近の変更を特定

以下のコマンドで最近の変更を確認する：

```bash
# 最新コミットで変更されたファイル一覧
git diff HEAD~1 --name-only

# 変更の統計
git log -1 --stat

# 詳細な差分
git diff HEAD~1
```

※ ユーザーが特定のファイルを指定した場合はそちらを優先

---

## Phase 2: 簡素化パターンの分析

以下の6パターンをチェックする：

### 1. 🔄 重複コード
- 繰り返しロジック → 関数に抽出
- 類似関数 → 統合可能か検討
- コピペコード → 共通化

### 2. 🏗️ 過剰設計
- 1回しか使わない抽象化
- 不要なラッパー関数
- パラメータ過多な関数
- 早すぎる汎用化

### 3. 💀 デッドコード
- 未使用の変数・関数
- 到達不能な分岐
- コメントアウトされたコード
- 使われていないimport/依存

### 4. 🌳 複雑な条件分岐
- ネストした if-else → 早期リターンでフラットに
- 複雑なboolean式 → 名前付き変数に抽出
- 簡素化できるガード節

### 5. 📏 長い関数
- 20行超の関数 → 分割を検討
- 複数の責任を持つ関数 → 単一責任に
- パラメータ多すぎ → オブジェクトで渡す

### 6. ⚠️ 不要な複雑さ
- 失敗しないコードの try-catch
- nullになり得ない値の null チェック
- 起こり得ないケースの防御コード

---

## Phase 3: 簡素化の提案

各発見に対して以下の形式で提示：

```
### 簡素化: [短い説明]

**場所**: `ファイル名:行番号`
**種別**: [重複/過剰設計/デッドコード/複雑な条件/長い関数/不要な複雑さ]

**現在** (X行):
```[lang]
[コードブロック]
```

**簡素化後** (Y行):
```[lang]
[コードブロック]
```

**メリット**: [なぜこれが良いか]
**リスク**: 低 - 動作は変更なし
```

---

## Phase 4: 簡素化の適用

ユーザーの承認後：

1. **一度に1つずつ変更** - 複数の変更を同時にしない
2. **変更ごとにテスト実行** - 動作確認を必ず行う
3. **明確なコミットメッセージ** - `refactor: simplify [説明]`
4. **次の簡素化へ進む**

---

## 出力フォーマット

```
## 📊 簡素化レポート

### 分析した変更
- ファイル数: [count]
- 追加行数: [count]
- 削除行数: [count]

### 簡素化の機会

[各機会を現在/簡素化後のコードと共に一覧]

### サマリー
- 発見した簡素化ポイント: X件
- 削減可能な行数（推定）: Y行
- 複雑さの削減度: [高/中/低]

### 推奨アクション
1. [ ] 簡素化 #1 を適用（最もインパクト大）
2. [ ] 簡素化 #2 を適用
...

### 適用後に実行すべきテスト
- [動作変更がないことを確認するテストコマンド一覧]
```

---

## 安全ルール

1. ❌ **動作を絶対に変えない** - 構造のみ変更
2. ✅ **変更ごとにテスト** - 壊れていないことを確認
3. 📦 **変更は原子的に** - 1簡素化 = 1コミット
4. 📝 **何を簡素化したか記録** - 明確なコミットメッセージ
5. 🔒 **公開APIは保持** - 内部リファクタリングのみ

---

## 使用例

```
# セッション終了時に使用
/code-simplifier

# 特定のファイルを指定
/code-simplifier src/components/Header.tsx

# PRのレビュー時
/code-simplifier --pr
```

---

**注意**: このワークフローは Claude Code の code-simplifier エージェントを参考に作成されました。
